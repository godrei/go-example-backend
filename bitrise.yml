format_version: "11"
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git
meta:
  bitrise.io:
    machine_type_id: standard
    stack: linux-docker-android-20.04
workflows:
  _clone:
    steps:
    - activate-ssh-key@4: {}
    - git-clone@8: {}
    - script:
        inputs:
        - script_file_path: null
        - content: |-
            set -ex
            go version
  test:
    before_run:
    - _clone
    container:
      image: golang:1.22
    services:
      redis:
        image: redis:latest
        ports:
        - 6379:6379
        options: --health-cmd "redis-cli ping" --health-interval 10s --health-timeout 5s --health-retries 5
    envs:
    - REDIS_DSN: redis:6379
    steps:
    - script:
        inputs:
        - content: go version
    - script:
        title: Run tests
        inputs:
        - content: go test ./...